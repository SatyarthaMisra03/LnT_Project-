<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Office Inventory Updation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <style>
        /* Animations */
        .fade-out { opacity: 0; visibility: hidden; transition: opacity 0.5s ease-out, visibility 0.5s; }
        .fade-in { animation: fadeIn 0.8s ease-in forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        /* Spinner */
        .loader { border: 3px solid #f3f3f3; border-radius: 50%; border-top: 3px solid #4f46e5; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50 font-sans text-slate-800 h-screen overflow-hidden relative">

    <div id="welcome-screen" class="absolute inset-0 z-50 bg-gradient-to-br from-slate-900 via-indigo-900 to-slate-900 flex flex-col items-center justify-center text-center px-4">
        <div class="mb-8 p-6 bg-white/10 rounded-full backdrop-blur shadow-2xl border border-white/20">
            <span class="text-6xl">üåê</span>
        </div>
        <h1 class="text-4xl md:text-6xl font-extrabold text-white mb-4 tracking-tight">Inventory Updation</h1>
        <p class="text-lg text-indigo-200 mb-10 max-w-lg">
            Global Inventory Data Entry Portal.<br>
            <span class="text-xs opacity-70">Secure Connection to Cloud Database</span>
        </p>
        <button onclick="enterSystem()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-4 px-10 rounded-full transition transform hover:-translate-y-1 shadow-lg hover:shadow-indigo-500/50 ring-4 ring-indigo-500/30">
            Access Portal
        </button>
    </div>


    <div id="configModal" class="fixed inset-0 z-40 bg-black/60 hidden flex items-center justify-center backdrop-blur-sm px-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden transform transition-all scale-100">
            <div class="bg-indigo-600 p-4 flex justify-between items-center">
                <h3 class="text-white font-bold text-lg">‚öôÔ∏è Manage Asset Types</h3>
                <button onclick="closeConfig()" class="text-white hover:text-indigo-200 text-xl font-bold">&times;</button>
            </div>
            <div class="p-6">
                <p class="text-sm text-gray-500 mb-4">Add custom item types (e.g., "Vehicle", "Server") to your dropdown.</p>
                
                <div class="flex gap-2 mb-6">
                    <input type="text" id="newCatInput" placeholder="New Type Name" class="flex-1 border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-indigo-500 outline-none">
                    <button onclick="addCategory()" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 font-bold">+</button>
                </div>

                <div class="bg-gray-50 rounded border border-gray-200 h-48 overflow-y-auto p-2 space-y-1" id="categoryList">
                    </div>
            </div>
            <div class="bg-gray-100 p-3 text-right">
                <button onclick="closeConfig()" class="text-gray-600 text-sm font-bold hover:text-gray-900 px-4 py-2">Done</button>
            </div>
        </div>
    </div>


    <div id="main-app" class="hidden h-full w-full overflow-y-auto">
        <div class="min-h-screen flex flex-col items-center py-12 px-4">
            
            <div class="w-full max-w-3xl space-y-6">
                
                <div class="text-center space-y-2 mb-6">
                    <div class="inline-flex items-center gap-2 px-3 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full uppercase tracking-wide">
                        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> Online Mode
                    </div>
                    <h2 class="text-3xl font-bold text-gray-800">Data Entry Terminal</h2>
                    <div class="flex justify-center gap-2 pt-2">
                         <a href="https://sheets.google.com" target="_blank" class="text-xs text-indigo-600 hover:underline font-semibold">Open Database (Google Sheet) ‚Üó</a>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-2xl shadow-xl border border-gray-100">
                    
                    <form name="submit-to-google-sheet" id="assetForm" class="space-y-5">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <div>
                                <div class="flex justify-between items-center mb-1">
                                    <label class="text-xs font-bold uppercase text-gray-400">Asset Type</label>
                                    <button type="button" onclick="openConfig()" class="text-[10px] text-indigo-600 font-bold hover:underline bg-indigo-50 px-2 py-0.5 rounded cursor-pointer">‚öôÔ∏è EDIT</button>
                                </div>
                                <select name="type" id="typeSelect" class="w-full border-gray-200 border rounded-lg p-3 bg-gray-50 focus:ring-2 focus:ring-indigo-500 outline-none transition"></select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold uppercase text-gray-400 mb-1">Status</label>
                                <select name="status" class="w-full border-gray-200 border rounded-lg p-3 bg-gray-50 focus:ring-2 focus:ring-indigo-500 outline-none">
                                    <option value="Active">Active</option>
                                    <option value="In Repair">In Repair</option>
                                    <option value="Retired">Retired</option>
                                    <option value="In Storage">In Storage</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <div>
                                <label class="block text-xs font-bold uppercase text-gray-400 mb-1">Brand</label>
                                <input type="text" name="brand" required placeholder="e.g. Dell" class="w-full border-gray-200 border rounded-lg p-3 outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label class="block text-xs font-bold uppercase text-gray-400 mb-1">Model</label>
                                <input type="text" name="model" required placeholder="e.g. XPS 15" class="w-full border-gray-200 border rounded-lg p-3 outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <div>
                                <label class="block text-xs font-bold uppercase text-gray-400 mb-1">Serial Number</label>
                                <input type="text" name="serial" required placeholder="SN-XXXX" class="w-full border-gray-200 border rounded-lg p-3 outline-none focus:ring-2 focus:ring-indigo-500 font-mono text-sm">
                            </div>
                            <div>
                                <label class="block text-xs font-bold uppercase text-gray-400 mb-1">Purchase Date</label>
                                <input type="date" name="pDate" required class="w-full border-gray-200 border rounded-lg p-3 outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                        </div>

                        <button type="submit" id="submitBtn" class="w-full bg-indigo-600 text-white py-3.5 rounded-lg font-bold text-lg hover:bg-indigo-700 transition shadow-lg flex justify-center items-center gap-3">
                            Upload to Cloud
                        </button>
                    </form>
                </div>

                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                    <div class="p-4 bg-gray-50 border-b flex justify-between items-center">
                        <h3 class="font-bold text-gray-700 text-sm">Session History (Recently Added)</h3>
                        <button onclick="exportSessionData()" class="text-xs bg-white border border-gray-300 px-2 py-1 rounded hover:bg-gray-100">Download Session Excel</button>
                    </div>
                    <div class="overflow-x-auto max-h-60">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-gray-50 text-gray-500 uppercase text-xs sticky top-0">
                                <tr>
                                    <th class="px-6 py-3">Type</th>
                                    <th class="px-6 py-3">Serial</th>
                                    <th class="px-6 py-3 text-center">Status</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody" class="divide-y divide-gray-100">
                                </tbody>
                        </table>
                    </div>
                    <div id="emptyState" class="p-6 text-center text-gray-400 text-xs italic">
                        Items added in this session will appear here.
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // ********************************************************
        // üö® IMPORTANT: PASTE YOUR GOOGLE SCRIPT URL HERE üëá
        // ********************************************************
        const scriptURL = 'PASTE_YOUR_GOOGLE_SCRIPT_URL_HERE'; 
        // ********************************************************


        // --- 1. DYNAMIC CATEGORY LOGIC ---
        let assetTypes = JSON.parse(localStorage.getItem('xyzTypes')) || ['Laptop', 'Desktop', 'Monitor', 'Printer', 'Router'];
        const typeSelect = document.getElementById('typeSelect');
        const modal = document.getElementById('configModal');
        const categoryListDiv = document.getElementById('categoryList');

        function initCategories() {
            typeSelect.innerHTML = '';
            categoryListDiv.innerHTML = '';
            assetTypes.forEach((type, idx) => {
                // Dropdown
                const opt = document.createElement('option');
                opt.value = type; opt.text = type;
                typeSelect.appendChild(opt);
                
                // Modal List
                const div = document.createElement('div');
                div.className = "flex justify-between items-center bg-white p-2 rounded border border-gray-100";
                div.innerHTML = `<span class="text-sm font-medium text-gray-700">${type}</span> <button onclick="removeCategory(${idx})" class="text-red-400 hover:text-red-600 px-2">&times;</button>`;
                categoryListDiv.appendChild(div);
            });
        }
        
        function addCategory() {
            const val = document.getElementById('newCatInput').value.trim();
            if(val && !assetTypes.includes(val)) {
                assetTypes.push(val);
                localStorage.setItem('xyzTypes', JSON.stringify(assetTypes));
                initCategories();
                document.getElementById('newCatInput').value = '';
            }
        }
        
        function removeCategory(idx) {
            if(confirm('Remove this category?')) {
                assetTypes.splice(idx, 1);
                localStorage.setItem('xyzTypes', JSON.stringify(assetTypes));
                initCategories();
            }
        }

        function openConfig() { modal.classList.remove('hidden'); }
        function closeConfig() { modal.classList.add('hidden'); }
        
        // Initialize on load
        initCategories();


        // --- 2. CLOUD SUBMISSION LOGIC ---
        const form = document.forms['submit-to-google-sheet'];
        const btn = document.getElementById('submitBtn');
        const tableBody = document.getElementById('tableBody');
        const emptyState = document.getElementById('emptyState');
        
        // Local Session Array (Just for display)
        let sessionData = [];

        form.addEventListener('submit', e => {
            e.preventDefault();
            
            // UI Loading State
            const originalBtnContent = btn.innerHTML;
            btn.innerHTML = '<div class="loader"></div> Syncing...';
            btn.disabled = true;
            btn.classList.add('opacity-75');

            fetch(scriptURL, { method: 'POST', body: new FormData(form)})
                .then(response => {
                    // 1. Add to Session Table (Visual Feedback)
                    const formData = new FormData(form);
                    const newItem = Object.fromEntries(formData.entries());
                    sessionData.push(newItem);
                    updateSessionTable();

                    // 2. Reset Form & Button
                    form.reset();
                    btn.innerHTML = "‚úÖ Uploaded Successfully";
                    btn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                    btn.classList.add('bg-green-600', 'hover:bg-green-700');
                    
                    setTimeout(() => {
                        btn.innerHTML = originalBtnContent;
                        btn.disabled = false;
                        btn.classList.remove('opacity-75', 'bg-green-600', 'hover:bg-green-700');
                        btn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
                    }, 2000);
                })
                .catch(error => {
                    console.error('Error!', error.message);
                    alert("Connection Error! Check your internet or Script URL.");
                    btn.innerHTML = originalBtnContent;
                    btn.disabled = false;
                    btn.classList.remove('opacity-75');
                });
        });

        function updateSessionTable() {
            if(sessionData.length > 0) emptyState.style.display = 'none';
            tableBody.innerHTML = '';
            // Show last 5 items in reverse order
            sessionData.slice().reverse().forEach(item => {
                let badge = item.status === 'Active' ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-600';
                const row = `
                    <tr class="hover:bg-slate-50 transition">
                        <td class="px-6 py-3 font-medium text-gray-800">${item.type}</td>
                        <td class="px-6 py-3 font-mono text-xs text-gray-500">${item.serial}</td>
                        <td class="px-6 py-3 text-center"><span class="${badge} px-2 py-1 rounded text-xs font-bold">${item.status}</span></td>
                    </tr>`;
                tableBody.innerHTML += row;
            });
        }

        // --- 3. EXCEL EXPORT (SESSION DATA) ---
        function exportSessionData() {
            if(sessionData.length === 0) return alert("No new data in this session to export.");
            const ws = XLSX.utils.json_to_sheet(sessionData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Session_Data");
            XLSX.writeFile(wb, "XYZ_Session_Uploads.xlsx");
        }


        // --- 4. WELCOME ANIMATION ---
        function enterSystem() {
            const welcome = document.getElementById('welcome-screen');
            const app = document.getElementById('main-app');
            welcome.classList.add('fade-out');
            setTimeout(() => {
                welcome.style.display = 'none';
                app.classList.remove('hidden');
                app.classList.add('fade-in');
                document.body.style.overflow = 'auto';
            }, 500);
        }

    </script>
</body>
</html>